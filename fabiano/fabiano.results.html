<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Resultado | Fabiano Lucas</title>
  <!-- For√ßa o carregamento do estilo -->
  <link rel="stylesheet" href="../style.css" onerror="this.onerror=null;this.href='data:text/css, body { font-family: Arial, sans-serif; padding: 20px; } .container { max-width: 600px; margin: 40px auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); } .btn-link { display: block; width: 100%; padding: 14px; background: #2c5282; color: white; text-align: center; border: none; border-radius: 10px; font-size: 18px; margin-top: 20px; text-decoration: none; }';">
  <style>
    /* Estilo de seguran√ßa caso o CSS externo falhe */
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f5f8ff;
      color: #333;
      line-height: 1.6;
    }
    .container {
      max-width: 700px;
      margin: 50px auto;
      padding: 30px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 6px 25px rgba(0, 0, 0, 0.1);
    }
    header h1 {
      font-size: 26px;
      color: #2c5282;
      text-align: center;
    }
    .diagnosis p, .recommendation p {
      font-size: 16px;
      line-height: 1.7;
    }
    .btn-link {
      display: block;
      width: 100%;
      padding: 14px;
      background: #2c5282;
      color: white;
      text-align: center;
      border: none;
      border-radius: 10px;
      font-size: 18px;
      margin-top: 25px;
      text-decoration: none;
    }
    .btn-link:hover {
      background: #1d3a57;
    }
    .error {
      color: #d32f2f;
      font-size: 15px;
      text-align: center;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container" id="resultContainer">
    <header>
      <h1>Perfil do Seu Relacionamento</h1>
      <p>An√°lise por <strong>Fabiano Lucas</strong></p>
    </header>

    <div class="diagnosis">
      <h2>üîç Diagn√≥stico Inicial</h2>
      <p id="resultText">Carregando...</p>
    </div>

    <div class="recommendation">
      <h2>üí° Recomenda√ß√£o</h2>
      <p id="recommendation">Carregando...</p>
    </div>

    <div class="cta">
      <h2>üìÖ Agende Sua Sess√£o com Fabiano</h2>
      <p>Vamos juntos fortalecer ou reconstruir seu relacionamento com apoio especializado.</p>
      <!-- Bot√£o de agendamento vis√≠vel mesmo se JS falhar -->
      <a href="https://calendly.com/fabianolucas-casal" target="_blank" class="btn-link" id="scheduleBtn">
        Agendar Minha Sess√£o
      </a>
      <button onclick="generatePDF()" style="margin-top:15px; width:100%; padding:12px; background:#1a3a5f; color:white; border:none; border-radius:8px; font-size:16px;">
        üìÑ Baixar Relat√≥rio em PDF
      </button>
    </div>

    <!-- Mensagem de erro (aparece s√≥ se falhar) -->
    <p id="errorMessage" class="error" style="display:none;">
      Voc√™ precisa responder o question√°rio primeiro. <a href="../fabiano" style="color:#2c5282;">Clique aqui para voltar</a>.
    </p>
  </div>

  <!-- Carrega jsPDF com fallback -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous"></script>

  <script>
    // Fun√ß√£o principal ao carregar a p√°gina
    window.onload = function () {
      try {
        // Verifica se o totalScore foi salvo
        const totalScore = localStorage.getItem("totalScore");

        const resultTextEl = document.getElementById("resultText");
        const recommendationEl = document.getElementById("recommendation");
        const container = document.getElementById("resultContainer");
        const errorEl = document.getElementById("errorMessage");
        const scheduleBtn = document.getElementById("scheduleBtn");

        if (totalScore === null || totalScore === undefined) {
          // Dados n√£o encontrados
          resultTextEl.textContent = "N√£o foi poss√≠vel carregar o diagn√≥stico.";
          recommendationEl.textContent = "Parece que voc√™ n√£o completou o question√°rio. Por favor, responda primeiro.";
          container.style.backgroundColor = "#ffeaea";
          errorEl.style.display = "block";
          scheduleBtn.style.display = "none";
          return;
        }

        const total = parseInt(totalScore);
        const media = total / 10;

        let resultText = "";
        let recommendation = "";
        let bgColor = "#f0f7ff";

        if (media >= 2.8) {
          resultText = "Seu relacionamento est√° saud√°vel e com boa conex√£o emocional.";
          recommendation = "Parab√©ns! Voc√™s t√™m uma base s√≥lida. A terapia pode ajudar a fortalecer ainda mais sua comunica√ß√£o, intimidade e projetos em comum.";
          bgColor = "#e8f5e8";
        } else if (media >= 2.0) {
          resultText = "Seu relacionamento tem pontos fortes, mas tamb√©m desafios importantes.";
          recommendation = "H√° sinais de distanciamento, conflitos ou falta de di√°logo. A terapia de casal pode ajudar a reconectar, alinhar expectativas e restaurar a parceria.";
          bgColor = "#fff9e6";
        } else if (media >= 1.2) {
          resultText = "Seu relacionamento est√° em fase de desgaste ou crise.";
          recommendation = "Conflitos frequentes, desconfian√ßa ou ressentimentos indicam necessidade de apoio profissional para decidir se vale a pena reconstruir ou se despedir com respeito.";
          bgColor = "#fff4e6";
        } else {
          resultText = "Seu relacionamento est√° em situa√ß√£o de alta tens√£o ou desist√™ncia.";
          recommendation = "O distanciamento emocional, falta de esperan√ßa e repeti√ß√£o de ciclos t√≥xicos exigem interven√ß√£o terap√™utica urgente ‚Äî seja para recome√ßar ou para um desligamento consciente.";
          bgColor = "#ffeaea";
        }

        // Atualiza o conte√∫do
        resultTextEl.textContent = resultText;
        recommendationEl.textContent = recommendation;
        container.style.backgroundColor = bgColor;

        // Garante que o bot√£o de agendamento esteja vis√≠vel
        scheduleBtn.style.display = "block";
        scheduleBtn.href = "https://calendly.com/fabianolucas"; // üîó ATUALIZE COM SEU LINK REAL

      } catch (error) {
        console.error("Erro ao carregar resultados:", error);
        document.getElementById("resultText").textContent = "Erro ao carregar diagn√≥stico.";
        document.getElementById("recommendation").textContent = "Recarregue a p√°gina ou volte ao question√°rio.";
        document.getElementById("resultContainer").style.backgroundColor = "#ffeaea";
        document.getElementById("errorMessage").style.display = "block";
        document.getElementById("scheduleBtn").style.display = "none";
      }
    };

    // Fun√ß√£o para gerar PDF (com prote√ß√£o)
    function generatePDF() {
      try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        const totalScore = localStorage.getItem("totalScore");
        if (!totalScore) {
          alert("Erro: voc√™ precisa responder o question√°rio primeiro.");
          window.location.href = "../fabiano";
          return;
        }

        const media = (totalScore / 10).toFixed(2);
        const resultText = document.getElementById("resultText").textContent;
        const recommendation = document.getElementById("recommendation").textContent;

        doc.setFontSize(20);
        doc.text("Relat√≥rio - Casal", 10, 20);

        doc.setFontSize(12);
        doc.text(`Terapeuta: Fabiano Lucas`, 10, 35);
        doc.text(`Pontua√ß√£o: ${totalScore} / 30`, 10, 50);
        doc.text(`N√≠vel: ${media}`, 10, 65);
        doc.text(`Diagn√≥stico:`, 10, 80);
        doc.setFontSize(11);
        const splitDiag = doc.splitTextToSize(resultText, 170);
        doc.text(splitDiag, 10, 85);

        doc.setFontSize(12);
        doc.text(`Recomenda√ß√£o:`, 10, 110);
        doc.setFontSize(11);
        const splitRec = doc.splitTextToSize(recommendation, 170);
        doc.text(splitRec, 10, 115);

        doc.setFontSize(12);
        doc.text("Agende sua sess√£o:", 10, 150);
        doc.setTextColor(0, 0, 255);
        doc.text("calendly.com/fabianolucas-casal", 10, 160);
        doc.setTextColor(0, 0, 0);
        doc.text("TheraLink - Transforme seu relacionamento.", 10, 180);

        doc.save("relatorio-fabiano-casal.pdf");
      } catch (e) {
        alert("Erro ao gerar PDF. Tente novamente ou entre em contato.");
        console.error(e);
      }
    }
  </script>
</body>
</html>
